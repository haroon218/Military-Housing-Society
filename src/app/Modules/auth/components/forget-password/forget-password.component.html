<div
    class="bg-surface-50 dark:bg-surface-950 flex items-center justify-center min-h-screen min-w-[100vw] overflow-hidden">
    <div class="flex flex-col items-center justify-center">
        <div
            style="border-radius: 56px; padding: 0.3rem; background: linear-gradient(180deg, var(--primary-color) 10%, rgba(33, 150, 243, 0) 30%)">
            <div class="w-full bg-surface-0 dark:bg-surface-900 py-20 px-8 sm:px-20" style="border-radius: 53px">
                <div class="text-center mb-8">
                    <div class="flex justify-center mb-4">
                        <img src="/assets/images/logo.jpeg" alt="Logo" loading="lazy" style="max-height: 100px;">
                    </div>
                    <h1 class="text-surface-900 dark:text-surface-0 text-3xl font-medium mb-4">Forgot Password</h1>
                    <p class="text-muted-color font-medium">Enter your email to reset password</p>
                </div>

                <!-- Step 1: Enter Email -->
                <form *ngIf="step === 1" [formGroup]="emailForm" (ngSubmit)="sendOtp()">
                    <div class="flex flex-col mb-4">
                        <label for="email"
                            class="text-xl font-medium mb-2 text-surface-900 dark:text-surface-0">Email</label>
                        <input pInputText id="email" formControlName="email" placeholder="Enter Email"
                            class="w-full md:w-[30rem] mb-1" />
                        <small *ngIf="emailForm.get('email')?.touched && emailForm.get('email')?.hasError('required')"
                            style="color:red;">Email is required</small>
                        <small *ngIf="emailForm.get('email')?.touched && emailForm.get('email')?.hasError('email')"
                            style="color:red;">Invalid email</small>
                    </div>
                    <p-button type="submit" [label]="loading ? '' : 'Send OTP'" [loading]="loading"
                        [disabled]="loading || emailForm.invalid" styleClass="custom-login-button w-full md:w-[30rem]"></p-button>
                </form>

                <!-- Step 2: Enter OTP -->
                <form *ngIf="step === 2" [formGroup]="otpForm" (ngSubmit)="verifyOtp()">
  <div class="flex flex-col mb-6 w-full md:w-[30rem] mx-auto">
    <label for="otp" class="text-xl font-medium mb-2 text-surface-900 dark:text-surface-0 text-center">Enter OTP</label>
    
    <!-- Center OTP input boxes -->
    <div class="flex justify-center mb-2">
       <p-inputotp formControlName="otp" [length]="6" [mask]="true" [integerOnly]="true"
                            inputStyleClass="w-10 h-10 text-center mx-1 text-lg border rounded"></p-inputotp>
    </div>

    <small *ngIf="otpForm.get('otp')?.touched && otpForm.get('otp')?.hasError('required')" style="color:red; text-align:center;">
      OTP is required
    </small>
  </div>

  <!-- Timer display -->
  <div class="mb-4 text-sm text-muted-color w-full md:w-[30rem] text-center">
    <span *ngIf="timeLeft > 0">Resend OTP in {{ timeLeft | number:'2.0' }} seconds</span>
    <span *ngIf="timeLeft === 0">Didn't receive OTP?</span>
  </div>

  <!-- Resend button -->
  <p-button
    *ngIf="timeLeft === 0"
    type="button"
    label="Resend OTP"
    (click)="resendOtp()"
    [loading]="loading"
    styleClass="custom-login-button mb-4 w-full md:w-[30rem]">
  </p-button>

  <!-- Verify button -->
  <p-button
    *ngIf="timeLeft > 0 || resendClicked"
    type="submit"
    [label]="loading ? '' : 'Verify OTP'"
    [loading]="loading"
    [disabled]="loading || otpForm.invalid"
    styleClass="custom-login-button w-full md:w-[30rem]">
  </p-button>
</form>




                <!-- Step 3: Reset Password -->
                <form *ngIf="step === 3" [formGroup]="resetForm" (ngSubmit)="resetPassword()">
                               <div class="flex mt-2" style="flex-direction: column;">
                            <label for="pass" class="block text-surface-900 dark:text-surface-0 font-medium  mb-2">Password</label>
                            <p-password id="pass" formControlName="password" placeholder="Enter Password" [toggleMask]="true" styleClass="mb-1" [fluid]="true" [feedback]="false"></p-password>
                            @if (resetForm.get('password')?.touched && resetForm.get('password')?.hasError('required')) {
                                <small style="color: red;"> Password is required </small>
                            }
                        </div>

                     <div class="flex mt-2" style="flex-direction: column;">
                            <label for="pass" class="block text-surface-900 dark:text-surface-0 font-medium  mb-2">Confirm Password</label>
                            <p-password id="pass" formControlName="confirmPassword" placeholder=" confirm Password" [toggleMask]="true" styleClass="mb-6" [fluid]="true" [feedback]="false"></p-password>
                            @if (resetForm.get('confirmPassword')?.touched && resetForm.hasError('passwordMismatch')) {
                                <small style="color: red;"> Passwords do not match </small>
                            }
                        </div>

                    <p-button type="submit" [label]="loading ? '' : 'Reset Password'" [loading]="loading"
                        [disabled]="loading || resetForm.invalid" styleClass="custom-login-button w-full md:w-[30rem]">
                    </p-button>
                </form>

            </div>
        </div>
    </div>
</div>